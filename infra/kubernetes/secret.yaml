# NOTE: This is a template. Create actual secrets using:
# kubectl create secret docker-registry acr-secret \
#   --docker-server=${ACR_LOGIN_SERVER} \
#   --docker-username=${ACR_USERNAME} \
#   --docker-password=${ACR_PASSWORD} \
#   --namespace=platform-engineering

# Or use Azure Workload Identity (recommended)
---
apiVersion: v1
kind: Secret
metadata:
  name: acr-secret
  namespace: platform-engineering
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: <base64-encoded-docker-config>
---
# Azure SQL Connection Secret (created separately)
apiVersion: v1
kind: Secret
metadata:
  name: sql-secret
  namespace: platform-engineering
type: Opaque
stringData:
  username: "${SQL_ADMIN_USERNAME}"
  password: "${SQL_ADMIN_PASSWORD}"
---
# Azure Key Vault Secret Provider (recommended approach)
# This uses AAD Pod Identity / Workload Identity to access Key Vault
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-keyvault-secrets
  namespace: platform-engineering
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "${MANAGED_IDENTITY_CLIENT_ID}"
    keyvaultName: "${KEY_VAULT_NAME}"
    cloudName: "AzurePublicCloud"
    tenantId: "${AZURE_TENANT_ID}"
    objects: |
      array:
        - |
          objectName: sql-admin-password
          objectType: secret
          objectVersion: ""
        - |
          objectName: redis-connection-string
          objectType: secret
          objectVersion: ""
        - |
          objectName: storage-connection-string
          objectType: secret
          objectVersion: ""
        - |
          objectName: applicationinsights-connection-string
          objectType: secret
          objectVersion: ""
  secretObjects:
  - data:
    - key: sql-password
      objectName: sql-admin-password
    - key: redis-connection
      objectName: redis-connection-string
    - key: storage-connection
      objectName: storage-connection-string
    - key: appinsights-connection
      objectName: applicationinsights-connection-string
    secretName: azure-secrets
    type: Opaque
